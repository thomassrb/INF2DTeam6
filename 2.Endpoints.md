# API Endpoints

**Base URL:** `http://localhost:8000`

**Auth:** via `Authorization` header with session token (from `/login`)
**Content-Type:** JSON where indicated

---

## Auth & Users

| Methode | Endpoint | Auth | Doel | Body | Responses |
|---------|----------|------|------|------|-----------|
| POST    | /register | ✗ | Nieuwe gebruiker aanmaken | `{ "username": str, "password": str, "name": str, "phone": str, "email": str, "birth_year": str, "role"?: "ADMIN"\|"USER" }` | 201 User created · 409 Username already registered |
| POST    | /login | ✗ | Inloggen en session token krijgen | `{ "username": str, "password": str }` | 200 OK + token · 400 Missing credentials · 401 Invalid credentials · 429 Too many requests |
| GET | /logout | ✓ | Sessie beëindigen | — | 200 Logged out · 401 Unauthorized |
| GET | /profile | ✓ | Profiel van huidige user ophalen | — | 200 JSON user · 401 Unauthorized |
| PUT | /profile | ✓ | Profiel bijwerken | `{ "name"?: str, "password"?: str, "email"?: str, "phone"?: str, "birth_year"?: int }` | 200 Updated · 401 Unauthorized · 404 User not found |
| GET | /profile/{user_id} | ✓ (ADMIN/eigenaar) | Profiel van specifieke user ophalen | — | 200 JSON user · 401/403/404 |
| PUT | /profile/{user_id} | ADMIN | Profiel van specifieke user bijwerken | `{ "name"?: str, "password"?: str, "email"?: str, "phone"?: str, "birth_year"?: int }` | 200 Updated · 401/403/404 |

---

## Parking Lots

| Methode | Endpoint | Auth | Doel | Body | Responses |
|---------|----------|------|------|------|-----------|
| POST    | /parking-lots | ADMIN | Nieuwe parkeerplaats toevoegen | `{ "name": str, "location": str, "capacity": int, "tariff": float, "daytariff": float, "address": str, "coordinates": list }` | 201 Created · 401/403 Unauthorized |
| GET     | /parking-lots | ✗ | Lijst parkeerplaatsen | — | 200 JSON |
| GET     | /parking-lots/{lid} | ✗ | Details parkeerplaats | — | 200 JSON · 404 Not found |
| PUT     | /parking-lots/{lid} | ADMIN | Parkeerplaats bijwerken | `{ "name"?: str, "location"?: str, "capacity"?: int, "hourly_rate"?: float, "day_rate"?: float, "reserved"?: int }` | 200 Modified · 401/403/404 |
| DELETE  | /parking-lots/{lid} | ADMIN | Parkeerplaats verwijderen | — | 200 Deleted · 401/403/404 |

---

## Sessions

| Methode | Endpoint | Auth | Doel | Body | Responses |
|---------|----------|------|------|------|-----------|
| POST | /parking-lots/{lid}/sessions/start | ✓ | Start sessie | `{ "licenseplate": str }` | 201 Started · 401 Unauthorized · 404 Not found · 409 Conflict |
| POST | /parking-lots/{lid}/sessions/stop | ✓ | Stop sessie | `{ "licenseplate": str }` | 200 Stopped · 401 Unauthorized · 404 Not found · 409 Conflict |
| GET | /parking-lots/{lid}/sessions | ✓ | Sessie-overzicht | — | 200 JSON · 401 Unauthorized · 404 Not found |
| GET | /parking-lots/{lid}/sessions/{sid} | ✓ (ADMIN/eigenaar) | Specifieke sessie | — | 200 JSON · 401 Unauthorized · 403 Access denied · 404 Not found |
| DELETE | /parking-lots/{lid}/sessions/{sid} | ADMIN | Sessie verwijderen | — | 200 Deleted · 401 Unauthorized · 403 Access denied · 404 Not found |

---

## Reservations

| Methode | Endpoint | Auth | Doel | Body | Responses |
|---------|----------|------|------|------|-----------|
| POST | /reservations | ✓ | Nieuwe reservering aanmaken | `{ "licenseplate": str, "startdate": str, "enddate": str, "parkinglot": str, "user"?: str }` | 201 Success · 400 Invalid data · 401 Unauthorized · 403 Forbidden · 404 Parking lot not found |
| GET | /reservations | ✓ | Reserveringen ophalen | — | 200 JSON lijst · 401 Unauthorized |
| GET | /reservations/{rid} | ✓ (ADMIN/eigenaar) | Reservering ophalen | — | 200 JSON · 401/403/404 |
| PUT | /reservations/{rid} | ✓ (ADMIN/eigenaar) | Reservering bijwerken | `{ "licenseplate": str, "startdate": str, "enddate": str, "parkinglot": str, "user": str }` | 200 Updated · 400 Invalid data · 401 Unauthorized · 403 Forbidden · 404 Not found |
| DELETE | /reservations/{rid} | ✓ (ADMIN/eigenaar) | Reservering verwijderen | — | 200 Deleted · 400 Bad Request · 401 Unauthorized · 403 Forbidden · 404 Not found |

---

## Vehicles

| Methode | Endpoint | Auth | Doel | Body | Responses |
|---------|----------|------|------|------|-----------|
| POST | /vehicles | ✓ | Voertuig toevoegen | `{ "licenseplate": str, "name"?: str }` | 201 Success · 401 Unauthorized · 404 User not found · 409 Conflict |
| GET | /vehicles | ✓ | Eigen voertuigenlijst | — | 200 JSON lijst · 401 Unauthorized · 404 No vehicles found |
| GET | /vehicles/{vid} | ✓ (ADMIN/eigenaar) | Voertuigdetails ophalen | — | 200 JSON · 401/403/404 |
| PUT | /vehicles/{vid} | ✓ (ADMIN/eigenaar) | Voertuig bijwerken | `{ "name": str }` | 200 Success · 401/403/404 |
| DELETE | /vehicles/{vid} | ✓ (ADMIN/eigenaar) | Voertuig verwijderen | — | 200 Deleted · 401/403/404 |
| GET | /vehicles/{license_plate}/reservations | ✓ (ADMIN/eigenaar) | Reserveringen van voertuig ophalen | — | 200 JSON lijst · 401/403/404 |
| GET | /vehicles/{license_plate}/history | ✓ (ADMIN/eigenaar) | Historie van voertuig ophalen (reserveringen & sessies) | — | 200 JSON lijst · 401/403/404 |

---

## Payments

| Methode | Endpoint | Auth | Doel | Body | Responses |
|---------|----------|------|------|------|-----------|
| POST | /payments | ✓ | Nieuwe betaling | `{ "transaction": str, "amount": float }` | 201 Success · 401 Unauthorized |
| POST | /payments/refund | ADMIN | Refund uitvoeren | `{ "amount": float, "transaction"?: str, "coupled_to"?: str }` | 201 Success · 401 Unauthorized · 403 Forbidden |
| GET | /payments | ✓ (ADMIN/initiator/processor) | Eigen betalingen ophalen | — | 200 JSON lijst · 401 Unauthorized |
| GET | /payments/{pid} | ✓ (ADMIN/initiator/processor) | Betalingdetails ophalen | — | 200 JSON · 401 Unauthorized · 403 Forbidden · 404 Not found |
| PUT | /payments/{pid} | ✓ (ADMIN/initiator/processor) | Betaling valideren en bijwerken | `{ "t_data": dict, "validation": str }` | 200 Success · 401 Unauthorized · 403 Forbidden · 404 Not found |

---

## Billing

| Methode | Endpoint | Auth | Doel | Responses |
|---------|----------|------|------|-----------|
| GET | /billing | ✓ | Kostenoverzicht huidige user | — | 200 JSON lijst · 401 Unauthorized |
| GET | /billing/{username} | ADMIN | Kostenoverzicht gebruiker | — | 200 JSON lijst · 401 Unauthorized · 403 Forbidden |

---

## Other

| Methode | Endpoint | Responses |
|---------|----------|-----------|
| GET | /, /index, /index.html | 200 HTML |
| GET | /favicon.ico | 204 No Content |
| * | unknown path | 404 Not Found |

---

## Test Tips

```bash
uvicorn MobyPark.api.main:app --host 0.0.0.0 --port 8000 --reload

curl -X POST http://localhost:8000/register \
  -H "Content-Type: application/json" \
  -d '{"username":"testuser","password":"testpassword","name":"Test User","phone":"1234567890","email":"test@example.com","birth_year":"1990"}'

curl -X POST http://localhost:8000/login \
  -H "Content-Type: application/json" \
  -d '{"username":"testuser","password":"testpassword"}'

curl http://localhost:8000/profile -H "Authorization: Bearer <TOKEN>"
```
